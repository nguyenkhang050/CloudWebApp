<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Monitoring System</title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      body {
        background-color: #f8f9fa;
      }
  
      h1 {
        color: #333;
        margin-bottom: 20px;
        text-align: center;
      }
  
      .container-fluid {
        margin-top: 50px;
      }
  
      .table th,
      .table td {
        vertical-align: middle;
      }
  
      .robot-image {
        width: 50px;
        height: 50px;
      }
  
      .form-group {
        margin-bottom: 20px;
      }
  
      .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
      }
  
      .btn-primary:hover {
        background-color: #0069d9;
        border-color: #0062cc;
      }
  
      .btn-primary:focus,
      .btn-primary.focus {
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.5);
      }
    </style>
  </head>
<body>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <link  href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <script src='/socket.io/socket.io.js'></script>
  <ul class="pages">

    <li class="login page">
      <div class="container-fluid">
        <h1>Robot Monitoring System</h1>
        <div class="row">
          <div class="col-lg-6">
            <h2>Robot Status</h2>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Robot Name</th>
                  <th>Status</th>
                  <th>Time Operating</th>
                  <th>Power Supply Status</th>
                  <th>Motor Temperature</th>
                  <th>Reset Count</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Robot 1</td>
                  <td id="robot1-status">Running</td>
                  <td id="robot1-time-operating">2 hours 30 minutes</td>
                  <td id="robot1-power-status">OK</td>
                  <td id="robot1-motor-temp">40&deg;C</td>
                  <td id="robot1-reset-count">5</td>
                </tr>
                <tr>
                  <td>Robot 2</td>
                  <td>Stopped</td>
                  <td>0 hours 0 minutes</td>
                  <td>Low Battery</td>
                  <td>-</td>
                  <td>0</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="col-lg-6">
            <h2>Control Panel</h2>
            <form id="send-container">
              <div class="form-group">
                <label for="program">Send Program:</label>
                <textarea class="form-control" id="program" rows="5"></textarea>
              </div>
              <div class="form-group">
                <label for="robot">Robot:</label>
                <select class="form-control" id="robot">
                  <option>Robot 1</option>
                  <option>Robot 2</option>
                </select>
              </div>
              <div class="form-group">
                <label for="time">Set Operating Time:</label>
                <input type="datetime-local" id="time" name="time">
              </div>
              <button type="submit" class="btn btn-primary">Set</button>
            </form>
          </div>
        </div>
      </div>
      <span class="cartesian">X: <strong><span id="xText">0</span></strong></span><br>
    </li>
  </ul>

  <script>
    // const socket = io.connect('http://localhost:3700');
    const socket = io();
    const jobForm = document.getElementById('send-container');
    jobForm.addEventListener('submit', e => {
      e.preventDefault();
      const robot = document.getElementById('robot').value;
      const program = document.getElementById('program').value;
      const time = document.getElementById('time').value;
      socket.emit("JobSchedule", { robot, program, time });
      console.log("robot: " + robot + "; program: ", + program + "; time: " + time);  
    })
    
    socket.on("database", function(data){
      // console.log(data);
      const statusValue = data[0].Status_R1;
      document.getElementById("robot1-status").innerHTML = `${statusValue}`;

      const time_opValue = data[0].Time_Op_R1;
      const rounded_time_opValue = Math.round(time_opValue * 100) / 100;
      document.getElementById("robot1-time-operating").innerHTML = `${rounded_time_opValue}`;

      const power_statusValue = data[0].Power_Status_R1;
      document.getElementById("robot1-power-status").innerHTML = `${power_statusValue}`;

      const motor_tempValue = data[0].Motor_Temp_R1;
      console.log(motor_tempValue);
      const rounded_motor_tempValue = Math.round(motor_tempValue * 100) / 100; // round to 2 decimal places
      // console.log(rounded_motor_tempValue); 
      document.getElementById("robot1-motor-temp").innerHTML = `${rounded_motor_tempValue}&deg;C`;

      const reset_cntValue = data[0].Reset_Cnt_R1;
      document.getElementById("robot1-reset-count").innerHTML = `${reset_cntValue}`;
    })
</script>
<img src="/images/imgs/3dof_robot_arm.jpg" class="robot-image">
</body>
</html>